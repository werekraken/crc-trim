#!/usr/bin/env perl

use strict;
use warnings;

if (@ARGV != 3) {
  print $0, " <crcAB> <crcB> <lenB>\n";
  exit 1;
}

my ($crcAB, $crcB, $lenB) = (hex($ARGV[0]), hex($ARGV[1]), $ARGV[2]);

my @reverse_lookup = (
  0x00000000, 0xdb710641, 0x6d930ac3, 0xb6e20c82, 0xdb261586, 0x005713c7, 0xb6b51f45, 0x6dc41904,
  0x6d3d2d4d, 0xb64c2b0c, 0x00ae278e, 0xdbdf21cf, 0xb61b38cb, 0x6d6a3e8a, 0xdb883208, 0x00f93449,
  0xda7a5a9a, 0x010b5cdb, 0xb7e95059, 0x6c985618, 0x015c4f1c, 0xda2d495d, 0x6ccf45df, 0xb7be439e,
  0xb74777d7, 0x6c367196, 0xdad47d14, 0x01a57b55, 0x6c616251, 0xb7106410, 0x01f26892, 0xda836ed3,
  0x6f85b375, 0xb4f4b534, 0x0216b9b6, 0xd967bff7, 0xb4a3a6f3, 0x6fd2a0b2, 0xd930ac30, 0x0241aa71,
  0x02b89e38, 0xd9c99879, 0x6f2b94fb, 0xb45a92ba, 0xd99e8bbe, 0x02ef8dff, 0xb40d817d, 0x6f7c873c,
  0xb5ffe9ef, 0x6e8eefae, 0xd86ce32c, 0x031de56d, 0x6ed9fc69, 0xb5a8fa28, 0x034af6aa, 0xd83bf0eb,
  0xd8c2c4a2, 0x03b3c2e3, 0xb551ce61, 0x6e20c820, 0x03e4d124, 0xd895d765, 0x6e77dbe7, 0xb506dda6,
  0xdf0b66ea, 0x047a60ab, 0xb2986c29, 0x69e96a68, 0x042d736c, 0xdf5c752d, 0x69be79af, 0xb2cf7fee,
  0xb2364ba7, 0x69474de6, 0xdfa54164, 0x04d44725, 0x69105e21, 0xb2615860, 0x048354e2, 0xdff252a3,
  0x05713c70, 0xde003a31, 0x68e236b3, 0xb39330f2, 0xde5729f6, 0x05262fb7, 0xb3c42335, 0x68b52574,
  0x684c113d, 0xb33d177c, 0x05df1bfe, 0xdeae1dbf, 0xb36a04bb, 0x681b02fa, 0xdef90e78, 0x05880839,
  0xb08ed59f, 0x6bffd3de, 0xdd1ddf5c, 0x066cd91d, 0x6ba8c019, 0xb0d9c658, 0x063bcada, 0xdd4acc9b,
  0xddb3f8d2, 0x06c2fe93, 0xb020f211, 0x6b51f450, 0x0695ed54, 0xdde4eb15, 0x6b06e797, 0xb077e1d6,
  0x6af48f05, 0xb1858944, 0x076785c6, 0xdc168387, 0xb1d29a83, 0x6aa39cc2, 0xdc419040, 0x07309601,
  0x07c9a248, 0xdcb8a409, 0x6a5aa88b, 0xb12baeca, 0xdcefb7ce, 0x079eb18f, 0xb17cbd0d, 0x6a0dbb4c,
  0x6567cb95, 0xbe16cdd4, 0x08f4c156, 0xd385c717, 0xbe41de13, 0x6530d852, 0xd3d2d4d0, 0x08a3d291,
  0x085ae6d8, 0xd32be099, 0x65c9ec1b, 0xbeb8ea5a, 0xd37cf35e, 0x080df51f, 0xbeeff99d, 0x659effdc,
  0xbf1d910f, 0x646c974e, 0xd28e9bcc, 0x09ff9d8d, 0x643b8489, 0xbf4a82c8, 0x09a88e4a, 0xd2d9880b,
  0xd220bc42, 0x0951ba03, 0xbfb3b681, 0x64c2b0c0, 0x0906a9c4, 0xd277af85, 0x6495a307, 0xbfe4a546,
  0x0ae278e0, 0xd1937ea1, 0x67717223, 0xbc007462, 0xd1c46d66, 0x0ab56b27, 0xbc5767a5, 0x672661e4,
  0x67df55ad, 0xbcae53ec, 0x0a4c5f6e, 0xd13d592f, 0xbcf9402b, 0x6788466a, 0xd16a4ae8, 0x0a1b4ca9,
  0xd098227a, 0x0be9243b, 0xbd0b28b9, 0x667a2ef8, 0x0bbe37fc, 0xd0cf31bd, 0x662d3d3f, 0xbd5c3b7e,
  0xbda50f37, 0x66d40976, 0xd03605f4, 0x0b4703b5, 0x66831ab1, 0xbdf21cf0, 0x0b101072, 0xd0611633,
  0xba6cad7f, 0x611dab3e, 0xd7ffa7bc, 0x0c8ea1fd, 0x614ab8f9, 0xba3bbeb8, 0x0cd9b23a, 0xd7a8b47b,
  0xd7518032, 0x0c208673, 0xbac28af1, 0x61b38cb0, 0x0c7795b4, 0xd70693f5, 0x61e49f77, 0xba959936,
  0x6016f7e5, 0xbb67f1a4, 0x0d85fd26, 0xd6f4fb67, 0xbb30e263, 0x6041e422, 0xd6a3e8a0, 0x0dd2eee1,
  0x0d2bdaa8, 0xd65adce9, 0x60b8d06b, 0xbbc9d62a, 0xd60dcf2e, 0x0d7cc96f, 0xbb9ec5ed, 0x60efc3ac,
  0xd5e91e0a, 0x0e98184b, 0xb87a14c9, 0x630b1288, 0x0ecf0b8c, 0xd5be0dcd, 0x635c014f, 0xb82d070e,
  0xb8d43347, 0x63a53506, 0xd5473984, 0x0e363fc5, 0x63f226c1, 0xb8832080, 0x0e612c02, 0xd5102a43,
  0x0f934490, 0xd4e242d1, 0x62004e53, 0xb9714812, 0xd4b55116, 0x0fc45757, 0xb9265bd5, 0x62575d94,
  0x62ae69dd, 0xb9df6f9c, 0x0f3d631e, 0xd44c655f, 0xb9887c5b, 0x62f97a1a, 0xd41b7698, 0x0f6a70d9
);

my $crc = $crcAB ^ $crcB;

for (1 .. $lenB) {
  $crc = (($crc & 0xffffff) << 8) ^ $reverse_lookup[ ($crc >> 24) & 0xff ];
}

printf "%08x\n", $crc;

=head1 AUTHOR

matt cover, C<< <werekraken@gmail.com> >>

=head1 COPYRIGHT AND LICENSE

Copyright (c) 2014-2016, matt cover <werekraken@gmail.com>. All rights reserved.

This program is free software: you can redistribute it and/or modify
it under the terms of the Artistic License 2.0.

=cut
